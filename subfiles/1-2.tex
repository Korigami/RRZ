%!TEX root = ../RRZ.tex
%
\begin{theorem}[O różniczkowalnej zależności od parametru]
Niech
%
  \begin{equation*}
    y' = f(y,t,\lambda), \qquad
    f \colon \R^{m+1} \times \R \supset U \times (\lambda_0 - c, \lambda_0 + c) \longrightarrow \R^m,
  \end{equation*}
%
  gdzie $f$ jest funkcją ciągłą względem $y,t,\lambda$ oraz klasy $C^1$ względem $y,\lambda$. Ustalmy warunek 
  początkowy $(y_0,t_0)$ i oznaczmy przez $y(t,\lambda)$ rozwiązanie równania
%
  \begin{equation*}
    \frac{\partial y(t,\lambda)}{\partial t} = f(y,t,\lambda)
  \end{equation*}
%
  z warunkiem początkowym $y(t_0,\lambda) = y_0$, określone na ustalonym i \emph{zwartym} przedziale $I$. Wówczas na 
  przedziale $I$ istnieje ciągła funkcja
%
  \begin{equation*}
    z(t,\lambda_0) = \frac{\partial y(t,\lambda)}{\partial \lambda} \bigg\vert_{\lambda = \lambda_0}
  \end{equation*}
%
oraz zachodzi równość
%
  \begin{equation*}
    \frac{\partial z(t,\lambda_0)}{\partial t} =
    \frac{\partial^2 y(t,\lambda)}{\partial t \partial \lambda} \bigg\vert_{\lambda = \lambda_0} =
    \frac{\partial^2 y(t,\lambda)}{\partial \lambda \partial t} \bigg\vert_{\lambda = \lambda_0}.
  \end{equation*}
\end{theorem}

\begin{proof}
  Niech $y_\l(t) \in R_b$. Oznaczmy
%
  \begin{equation*}
    w_\l(t) \coloneqq \frac{ y_\l(t) - y_{\l_0}(t) }{ \l - \l_0 }
  \end{equation*}
%
  dla $\l \ne \l_0$. Wtedy
%
  \begin{multline*}
    \pd{t} w_\l(t) = \frac{ \pd{t} y_\l(t) - \pd{t} y_{\l_0}(t) }{ \l - \l_0 } = \frac{ f_\l\p[\big]{y_\l(t), t} - 
    f_{\l_0} \p[\big]{y_{\l_0}(t), t} }{ \l - \l_0 } = \\
    =  \frac{ f_\l \p[\big]{y_{\l_0}(t) + (\l - \l_0)w_\l(t), t} - 
    f_{\l_0} \p[\big]{y_{\l_0}(t), t} }{ \l - \l_0 } .
  \end{multline*}
%
  Rozważmy dalej funkcję
%
  \begin{equation*}
    F_\l(w, t) \coloneqq \frac{ f_\l \p[\big]{y_{\l_0}(t) + (\l - \l_0)w, t} - 
      f_{\l_0}\p[\big]{y_{\l_0}(t), t} }{ \l - \l_0 }.
  \end{equation*}
%
  Zwróćmy uwagę, że $w$ w definicji $F$ jest symbolem argumentu, a nie funkcji.

  Pokażemy, że istnieje taka stała $c^* > 0$, że o ile $ \abs{ \l - \l_0} \le c^*$, to dziedzina funkcji $F$ dla 
  każdego $\l$ spełniającego ten warunek jest zbiorem zwartym, a ponadto $w_\l(t)$ zawiera się w tej dziedzinie dla 
  każdego $t \in I$. 

%  
  \begin{nestedlemma}
    Przy założeniach takich jak powyżej, istnieją stałe $c_1, k_1 > 0$ takie, że
%
    \begin{equation*}
    \abs{ \l - \l_0 } \le c_1 \implies \norm[\big]{ w_\l(t) } \le k_1.
    \end{equation*} 
% 	 
  \end{nestedlemma}
%
  \begin{nestedproof}
  	Weźmy wpierw pewne $c_1 \colon 0 < c_1 < c$. Możemy zawęzić dziedzinę $f$ do $\l \in [\l_0 - c_1, \l + c_1]$. Wtedy $f$ jest funkcją klasy $C^1$ względem $\l$ zdefiniowaną na zbiorze zwartym (względem $\l$), a więc
  	jest ona lipszycowska względem $\l$ ze stałą $L_\l$.  Weźmy $\l \ne \l_0$ z tego zbioru. Możemy zatem wziąć w \ref{L: Kluczowy} $\eps = L_\l \abs{\l - \l_0}$. Zgodnie z tym lematem, zachodzi wtedy:
%
	\begin{equation*}
	  \norm{w_\l(t)} = \frac{ \norm[\big]{ y_\l(t) - y_{\l_0}(t) } }{\abs{ \l -\l_0}} \leq    L_\l \cdot e^{L \abs{t-t_0}} \cdot \abs{t-t_0} \eqqcolon k_1
	\end{equation*}
%
    Dla tak zdefiniowanego $k_1$ teza lematu jest spełniona. (Uwaga: dla każdego $\l$ bierzemy inny $\eps$, ale wciąż uzyskujemy to samo ograniczenie dla $\norm{w_\l(t)}$). \qedhere
  \end{nestedproof}
%
  Weźmy takie $c_1$ i $k_1$. Z kolei jeśli $\abs{ \l - \l_0 } \le \frac{ b }{ 2k_1 }$, to dla $w$ takich, że $\norm{ w } \le 2k_1$ zachodzi
%
  \begin{equation*}
    \norm[\big]{ y_{\l_0}(t) + (\l - \l_0)w - y_{\l_0}(t) } = \norm[\big]{ (\l - \l_0)w  } = \abs{ \l - \l_0 } \cdot 
    \norm{ w } \le \frac{ b }{ 2k_1 } \cdot 2k_1 = b.
  \end{equation*}
%
  Oznacza to, że dla każdego $t \in J$ (przy takich $\l$) jest
%
  \begin{equation*}
    \p[\big]{ y_{\l_0}(t) + (\l - \l_0)w, t} \in R_b.
  \end{equation*} 
%
  Niech $c^* = \min\p[\big]{c_1, \frac{ b }{ 2K_1 } }$. Wtedy $F$ jest zdefiniowana na zbiorze
%
  \begin{equation*}
    \overline{B}(0, 2K_1) \times I \times \p[\big]{ (\l_0 - c^*, \l_0 + c^*) \setminus \{ \l_0 \} } \text{.}
  \end{equation*}
%
Zdefiniujmy $F$ dla $\l = \l_0$ tak, by była ciągła względem $\l$ w tym punkcie. Wtedy
%
  \begin{align}
    \lim_{\l \to \l_0} F_\l(w, t) &= \lim_{\l \to \l_0} \frac{ f_\l\p[\big]{y_{\l_0}(t) + (\l - \l_0)w, t} -  
    f_{\l_0} \p[\big]{y_{\l_0}(t), t} }{ \l - \l_0 } \notag \\ 
    &=  \lim_{\l \to \l_0} \frac{ f_\l \p[\big]{y_{\l_0}(t) + (\l - \l_0)w, t} -  f_\l \p[\big]{y_{\l_0}(t), t} }{ w(\l 
    - \l_0) } \cdot w \, + \notag \\
    &\qquad+ \lim_{\l \to \l_0} \frac{ f_\l\p[\big]{y_{\l_0}(t), t} - f_{\l_0} \p[\big]{y_{\l_0}(t)} }{ \l - \l_0 } \notag \\
    &= D_y \, f_{\l_0} (y, t) \big\vert_{ y = y_{\l_0}(t) } \cdot w + \pd{ \l } f_{\l}( y_{\l_0}(t), t) 
    \big\vert_{ \l = \l_0 }, \label{eq: var}
  \end{align}
%
  przy czym powyższe pochodne istnieją, gdyż z założenia funkcja $f$ jest klasy $C^1$ względem zmiennych $y$ oraz $\l$. 
  Niech
%
  \begin{equation*}
    F_{\l_0}(w, t) \coloneqq \lim_{\l \to \l_0} F_\l(w, t).
  \end{equation*}
%
  Wtedy $F$ jest zdefiniowana na zbiorze
%
  \begin{equation*}
    \overline{B}(0, 2K_1) \times I \times (\l_0 - c^*, \l_0 + c^*),
  \end{equation*}
%
  który jest zwarty dla każdego ustalonego $\l$.
%
  \begin{nestedlemma}
    Funkcja $F$ zdefiniowana powyżej spełnia założenia twierdzenia o~ciągłej zależności od parametru przy równaniu 
    różniczkowym $\pd{t} w = F_\l(w, t)$.
  \end{nestedlemma}
%
  \begin{nestedproof}
    Nadobowiązkowy dowód Czytelnik wykona samodzielnie.
  \end{nestedproof}
%
  Zauważmy, że na mocy powyższego lematu oraz poprzednich rozważań funkcja $F_{\l_0}(w, t)$ jest ciągłą funkcją określoną
  na zbiorze zwartym, więc z Twierdzenia Peano istnieje rozwiązanie $w_{\l_0}$ równania $\pd{t} w = F_{\l_0}(w, t)$  określone w pewnym przedziale $J \subset I$ (dla ustalenia uwagi, niech $J$ będzie maksymalnym możliwym). 
  
  Rozwiązanie to jest jednoznaczne, gdyż dla każdego ciągu $\l_n \to \l_0$ zachodzi $w_{\l_n}(t) \rightrightarrows 
  w_{\l_0}(t)$. Gdybyśmy mieli dwa ciągi $\l_{n_1}, \l_{n_2} \to \l_0$, dla których $w_{\l_{n_1}}(t) \to w_{\l_0, 1}(t)$ oraz 
  $w_{\l_{n_2}}(t) \to w_{\l_0, 2}(t)$, to ciąg $\l_{n}$ z wyrazami na przemian z $\l_{n_1}$ i $\l_{n_2}$ również byłby zbieżny do $\l_0$, więc $w_{\l_{n}}$ także byłby zbieżny do jakiegoś rozwiązania. To zaś z jednoznaczności granicy oznacza, że $w_{\l_{n_1}}(t) = w_{\l_{n_2}}(t)$ dla każdego $t$. Stąd:
%
  \begin{equation*}
    w_{\l_0}(t) = \lim_{n \to \infty} w_{\l_n}(t) = \lim_{\l \to \l_0} w_{\l}(t) = \lim_{\l \to \l_0} \frac{ y_\l(t) - 
  	y_{\l_0}(t) }{ \l - \l_0 } = \pd{ \l } y_\l(t) \big\vert_{ \l = \l_0 }.
  \end{equation*}
%
  
  Ponadto $ J = I $. Przypuśćmy przeciwnie, że tak nie jest i bez straty ogólności załóżmy, że $\alpha$ jest prawym
  krańcem $J$, ale nie $I$. Skoro $F_{\l_0}$ spełnia założenia \ref{T: CZoP}, to jest ciągła i lipszycowska względem $w_{\l_0}$, a więc też jest lokalnie lipszycowska. Skoro $\norm{ w_\l(t) } \le k_1$, to po przejściu z nierównością do granicy także $\norm{ w_{\l_0}(t) } \le k_1$. Wreszcie $w_{\l_0}$ jest funkcją ciągłą, więc istnieje pewne otoczenie $U_\alpha$ punktu $\alpha$, dla
  którego $ t \in U_\alpha \implies \norm{ w_\l(t) } \le 2k_1$, więc istnieje zbiór zwarty $K$ oraz $\delta > 0$ takie, że 
%
  \begin{equation*}
    \forall t\in Dm w_{\l_0} \cap [\alpha - \delta, \alpha + \delta] \quad \big( w_{\l_0}(t), t \big) \in K.
  \end{equation*}
%
  Zatem z \ref{T: TOPK} $w_{\l_0}$ rozszerza się na przedział zawierajacy $\alpha$ we wnętrzu, co przeczyłoby maksymalności $J$.
  
  Na mocy powyższych rozważań $w_{\l_0}$ jest szukaną funkcją $z$ z tezy twierdzenia. Równość w twierdzeniu zachodzi, gdyż
%  
  \begin{align*}
  	\pd{\l} \pd{t} y_\l(t) \, \big\vert_{\l = \l_0} &= \lim_{\l \to \l_0} \frac{ \pd{t} y_\l(t) - \pd{t} y_{\l_0}(t) }{ \l - \l_0 } = \lim_{\l \to \l_0} F_\l(w_\l(t), t) = \\
  	& \overset{(\star)}{ = } F_{\l_0}(w_{\l_0}(t), t) = \pd{t} w_{\l_0}(t) = \pd{t} \pd{\l} y_\l(t) \, \big\vert_{\l = \l_0}
  \end{align*} 
%
  gdzie równość $(\star)$ zachodzi gdyż $F_\l(w, t)$ jest ciągła względem $w$ i $\l$, ponieważ spełnia założenia \ref{T: CZoP}, a $w_\l(t)$ ciągła względem $\l$ w punkcie $\l_0$.
  
  Wreszcie, poprzez podstawienie $w = w_{\l_0}(t)$ w \eqref{eq: var} otrzymujemy tzw. równanie na wariację:
%
  \begin{equation*}
  	\pd{t} w_{\l_0}(t) =  D_y \, f_{\l_0} (y, t) \big\vert_{ y = y_{\l_0}(t) } \cdot w_{\l_0}(t) + \pd{ \l } f_{\l}( y_{\l_0}(t), t) 
  	\big\vert_{ \l = \l_0 },
  \end{equation*} 
%
  z warunkiem początkowym $w_{\l_0}(t_0) = 0$. \qedhere
\end{proof}

%

%  \begin{align*}
%\pd{t} w_{\l_0}(t) &= \pd{t} \lim_{\l \to \l_0}  \frac{ y_\l(t) - y_{\l_0}(t) }{ \l - \l_0 } \\ &= \pd{t} \lim_{n 
%	\to 
%	\infty}
%\frac{ y_{\l_n}(t) - y_{\l_0}(t) }{ \l_n - \l_0 } \\
%&= \lim_{n \to \infty} \frac{  \pd{t} y_{\l_n}(t) -  \pd{t} y_{\l_0}(t) }{ \l_n - \l_0 } \\ &= \lim_{\l \to \l_0} 
%\frac{  
%	\pd{t} y_{\l_n}(t) -  \pd{t} y_{\l_0}(t) }{ \l_n - \l_0 }
%= \pd{\l } \pd{t} y_\l (t) \big\vert_{ \l = \l_0 }.
%\end{align*}
%






















